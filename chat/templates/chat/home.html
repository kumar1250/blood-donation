{% extends "base.html" %}
{% block title %}Chat Users{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 700px;">
    <h2 class="text-warning text-center mb-4">Available Users</h2>

    <!-- Search Bar -->
    <div class="mb-3">
        <input type="text" id="user-search" class="form-control" placeholder="Search users..." 
               style="border-radius: 25px; padding: 12px; background-color: #1e1e1e; color: #fff; border: 1px solid #444;">
    </div>

    <ul class="list-group" id="user-list">
        {% for user in users %}
        {% if user != request.user %}
        <li class="list-group-item p-0 mb-2" style="border: none; background: none;">
            <div class="d-flex justify-content-between align-items-center user-item" 
                 onclick="window.location='{% url 'chat:chat_view' user.username %}'" 
                 style="cursor: pointer;">
                
                <!-- Left: Avatar + Username -->
                <div class="d-flex align-items-center gap-3 p-3" style="flex: 1;">
                    <div class="avatar">{{ user.username|first|upper }}</div>
                    <span class="username">{{ user.username }}</span>
                </div>

                <!-- Right: Follow/Unfollow Button -->
                <div class="d-flex align-items-center gap-2 me-2">
                    {% if unread_counts.user.id|default:0 > 0 %}
                        <span class="badge bg-danger">{{ unread_counts.user.id }}</span>
                    {% endif %}

                    {% if user.id in following %}
                        <a href="{% url 'chat:follow_toggle' user.username %}" class="btn btn-sm btn-danger follow-btn">
                            <i class="bi bi-person-dash-fill"></i>
                        </a>
                    {% else %}
                        <a href="{% url 'chat:follow_toggle' user.username %}" class="btn btn-sm btn-success follow-btn">
                            <i class="bi bi-person-plus-fill"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
        </li>
        {% endif %}
        {% empty %}
        <li class="list-group-item text-center text-muted">
            No other users found.
        </li>
        {% endfor %}
    </ul>
</div>

<style>
/* Container & list items */
#user-list .user-item {
    background-color: #1e1e1e;
    border-radius: 15px;
    transition: all 0.3s ease;
}
#user-list .user-item:hover {
    background-color: #2a2a2a;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    transform: translateY(-2px);
}

/* Avatar style */
.avatar {
    width: 40px;
    height: 40px;
    background-color: #075e54;
    color: #fff;
    font-weight: bold;
    font-size: 1rem;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    text-transform: uppercase;
}

/* Username */
.username {
    color: #fff;
    font-weight: 500;
}

/* Buttons */
.follow-btn {
    border: none;
    border-radius: 50%;
    padding: 6px 10px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.follow-btn.btn-success {
    background-color: #28a745;
    color: #fff;
}
.follow-btn.btn-success:hover {
    background-color: #218838;
}

.follow-btn.btn-danger {
    background-color: #dc3545;
    color: #fff;
}
.follow-btn.btn-danger:hover {
    background-color: #c82333;
}

/* Badge */
.badge {
    font-size: 0.8rem;
}

/* Search input */
#user-search::placeholder {
    color: #ccc;
}

/* Responsive for mobile */
@media (max-width: 576px) {
    #user-list .user-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }

    .avatar {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
    }

    .follow-btn {
        padding: 5px 8px;
    }
}
</style>

<script>
  // Search users in real-time
  document.getElementById('user-search').addEventListener('input', function() {
      const filter = this.value.toLowerCase();
      const users = document.querySelectorAll('#user-list .user-item');
      users.forEach(user => {
          const username = user.querySelector('.username').textContent.toLowerCase();
          user.parentElement.style.display = username.includes(filter) ? 'block' : 'none';
      });
  });
</script>
{% endblock %}
