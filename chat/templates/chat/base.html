{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{% block title %}Chat{% endblock %}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap CSS & Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
    /* Body */
    body {
        background-color: #121212;
        color: #fff;
        font-family: 'Segoe UI', Arial, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Navbar */
    .navbar {
        background-color: #1f1f1f;
        border-bottom: 1px solid #333;
        box-shadow: 0 4px 8px rgba(0,0,0,0.5);
    }
    .navbar .navbar-brand {
        color: #25D366;
        font-weight: bold;
        font-size: 1.5rem;
        transition: all 0.2s;
    }
    .navbar .navbar-brand:hover { color: #1ebe57; }
    .navbar .navbar-text { color: #fff; font-weight: 500; }
    .navbar .btn { border-radius: 25px; font-weight: 500; transition: all 0.2s ease; }
    .navbar .btn-sm { padding: 5px 12px; }

    /* Container */
    .container {
        max-width: 1000px;
        flex: 1;
        display: flex;
        flex-direction: column;
        padding-bottom: 20px;
    }

    /* Layout */
    .chat-container {
        display: flex;
        gap: 15px;
        height: calc(100vh - 70px);
    }
    .sidebar {
        width: 250px;
        background-color: #1e1e1e;
        border-right: 1px solid #333;
        border-radius: 10px;
        overflow-y: auto;
        padding: 10px;
    }
    .sidebar h5 { color: #25D366; text-align: center; margin-bottom: 10px; }
    .sidebar a { color: #fff; text-decoration: none; display: block; padding: 8px; border-radius: 8px; transition: all 0.2s; }
    .sidebar a:hover, .sidebar a.active { background-color: #25D366; color: #000; }

    .chat-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .chat-box {
        flex: 1;
        background-color: #1e1e1e;
        border-radius: 15px;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .message {
        max-width: 70%;
        padding: 12px 18px;
        border-radius: 20px;
        font-size: 0.95rem;
        line-height: 1.4;
        position: relative;
        word-wrap: break-word;
        animation: fadeIn 0.3s ease;
    }
    .message.sent { align-self: flex-end; background: linear-gradient(135deg, #25D366, #128C7E); color: #fff; }
    .message.received { align-self: flex-start; background-color: rgba(42,42,42,0.85); color: #fff; }
    .timestamp { font-size: 0.65rem; color: #ccc; position: absolute; bottom: 2px; right: 12px; }

    .chat-input {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    .chat-input input {
        flex: 1;
        border-radius: 25px;
        padding: 12px 18px;
        border: none;
        background-color: #2a2a2a;
        color: #fff;
    }
    .chat-input input:focus { outline: none; border: 1px solid #25D366; }
    .chat-input button {
        border-radius: 50%;
        width: 50px;
        height: 50px;
        border: none;
        background-color: #25D366;
        color: #000;
        font-weight: bold;
    }
    .chat-input button:hover { transform: scale(1.1); }

    /* Animations */
    @keyframes fadeIn { from {opacity:0; transform: translateY(5px);} to {opacity:1; transform: translateY(0);} }

    /* Scrollbar */
    .chat-box::-webkit-scrollbar, .sidebar::-webkit-scrollbar { width: 8px; }
    .chat-box::-webkit-scrollbar-thumb, .sidebar::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
    .chat-box::-webkit-scrollbar-thumb:hover, .sidebar::-webkit-scrollbar-thumb:hover { background: #25D366; }

    /* Responsive */
    @media (max-width: 768px) {
        .chat-container { flex-direction: column; height: auto; }
        .sidebar { width: 100%; display: flex; overflow-x: auto; }
        .chat-box { height: 300px; }
    }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
            <a class="navbar-brand" href="/">Blood Donation</a>
            <a href="/" class="btn btn-sm btn-primary"><i class="bi bi-house-fill me-1"></i> Home</a>
            <a href="{% url 'chat:chat_home' %}" class="btn btn-sm btn-primary"><i class="bi bi-people-fill me-1"></i> Users</a>
        </div>
        <div class="d-flex align-items-center">
            {% if user.is_authenticated %}
                <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> {{ user.username }}</span>
                <a href="{% url 'logout' %}" class="btn btn-sm btn-danger"><i class="bi bi-box-arrow-right me-1"></i> Logout</a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-sm btn-success me-2"><i class="bi bi-box-arrow-in-right me-1"></i> Login</a>
                <a href="{% url 'signup' %}" class="btn btn-sm btn-primary"><i class="bi bi-person-plus-fill me-1"></i> Sign Up</a>
            {% endif %}
        </div>
    </div>
</nav>

<!-- Main Chat Layout -->
<div class="container mt-4 chat-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <h5>Users</h5>
        {% for user_item in users %}
            {% if user_item != request.user %}
                <a href="{% url 'chat' user_item.username %}" class="{% if user_item == other_user %}active{% endif %}">{{ user_item.username }}</a>
            {% endif %}
        {% empty %}
            <p class="text-muted text-center">No users online</p>
        {% endfor %}
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
        {% block content %}{% endblock %}
    </div>
</div>

<!-- Footer -->
<footer>
    &copy; {{ year|default:2025 }} Blood Donation App. All rights reserved.
</footer>

<script>
    // Auto-scroll chat to bottom
    const chatBox = document.querySelector('.chat-box');
    if(chatBox) chatBox.scrollTop = chatBox.scrollHeight;
</script>

</body>
</html>
